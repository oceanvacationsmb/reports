<!DOCTYPE html>
<html>
<head>
<title>Ocean Vacations - Reservation Report</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial;background:#f5f5f5;color:#000;display:flex}
.sidebar{width:280px;background:#333;color:#fff;padding:20px;height:100vh;overflow-y:auto;position:fixed;left:0;top:0}
.sidebar h3{margin-bottom:20px;font-size:16px;border-bottom:2px solid #fff;padding-bottom:10px}
.section{margin-bottom:20px}
.label{font-size:11px;font-weight:bold;color:#aaa;margin-bottom:5px;display:block}
select,input{width:100%;padding:8px;margin:5px 0;border:1px solid #555;background:#444;color:#fff;border-radius:3px;font-size:11px}
.btn{width:100%;padding:12px;margin:8px 0;border:none;font-weight:bold;border-radius:3px;cursor:pointer;font-size:12px;color:#fff;text-transform:uppercase}
.btn-primary{background:#000}
.btn-success{background:#28a745}
.btn-warning{background:#ff9800}
.btn-info{background:#17a2b8}
.btn-danger{background:#dc3545}
.debug-box{background:#222;color:#0f0;padding:15px;margin:10px 0;border-radius:3px;font-size:10px;max-height:150px;overflow-y:auto;font-family:monospace;border:1px solid #0f0}
.main{margin-left:280px;padding:20px;width:calc(100% - 280px)}
.page{background:#fff;padding:40px;border-radius:5px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}
.modal{display:none;position:fixed;z-index:1001;left:50%;top:50%;transform:translate(-50%,-50%);width:90%;max-width:500px;background:#333;color:#fff;border-radius:8px;padding:30px;box-shadow:0 4px 20px rgba(0,0,0,0.3);max-height:90vh;overflow-y:auto}
.modal.show{display:block}
.modal-title{font-size:20px;font-weight:bold;margin-bottom:20px;text-transform:uppercase;text-align:center;border-bottom:2px solid #fff;padding-bottom:15px}
.modal-field{margin-bottom:15px}
.modal-label{font-size:11px;font-weight:bold;color:#aaa;margin-bottom:8px;display:block;text-transform:uppercase}
.modal-input{width:100%;padding:10px;border:1px solid #555;background:#444;color:#fff;border-radius:3px;font-size:11px}
.modal-actions{display:flex;gap:10px;margin-top:25px}
.modal-actions button{flex:1;padding:12px;border:none;font-weight:bold;border-radius:3px;cursor:pointer;font-size:12px;color:#fff;text-transform:uppercase}
.btn-add{background:#28a745}
.btn-cancel{background:#666}
.btn-save{background:#0066cc}
.modal-overlay{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.7)}
.modal-overlay.show{display:block}
.settings-header{color:#fff;margin:20px 0 10px 0;font-size:12px;font-weight:bold;text-transform:uppercase;border-top:2px solid #555;padding-top:15px}
.token-status{padding:8px;margin:8px 0;border-radius:3px;text-align:center;font-size:11px;font-weight:bold}
.token-active{background:#28a745;color:#fff}
.token-inactive{background:#dc3545;color:#fff}
@media print{.sidebar,.debug-box{display:none}.main{margin-left:0;width:100%}}
</style>
</head>
<body>
<div class="sidebar">
<h3>üéØ OCEAN VACATIONS</h3>
<div id="tokenStatus" class="token-status token-inactive">üî¥ LOADING...</div>
<div class="debug-box" id="debugLog"></div>
<div class="section"><label class="label">SELECT OWNER</label><select id="ownerSelect" onchange="onOwnerChange()"><option value="">-- SELECT --</option></select></div>
<div class="section"><label class="label">MONTH</label><select id="monthSelect"></select></div>
<div class="section"><label class="label">YEAR</label><select id="yearSelect"></select></div>
<div class="settings-header">‚öôÔ∏è SETTINGS</div>
<button class="btn btn-warning" onclick="setupToken()" style="font-size:11px">üîë GITHUB SETUP</button>
</div>

<div id="modalOverlay" class="modal-overlay" onclick="closeAll()"></div>

<div class="main">
<div id="content" class="page">
<div style="text-align:center;padding:40px;color:#666">
<h2>Ocean Vacations Dashboard</h2>
<p>Click üîë GITHUB SETUP in the sidebar to authenticate.</p>
<p id="statusText" style="margin-top:20px;font-weight:bold;">Waiting for token...</p>
</div>
</div>
</div>

<script>
function debugLog(msg){
  console.log(msg);
  const box=document.getElementById("debugLog");
  if(box) box.innerHTML+=msg+"<br>";
}

function getGitHubAPI(){
  return "https://api.github.com/repos/oceanvacationsmb/reports/contents/data.json";
}

let OWNERS={},githubToken="";

function updateTokenStatus(){
  const status=document.getElementById("tokenStatus");
  if(githubToken){
    status.textContent="üü¢ TOKEN ACTIVE";
    status.className="token-status token-active";
    document.getElementById("statusText").textContent="‚úì Token is active! Data loaded.";
  }else{
    status.textContent="üî¥ NO TOKEN";
    status.className="token-status token-inactive";
  }
}

function loadData(){
  debugLog("üîç loadData() started");
  githubToken=localStorage.getItem("github_token")||"";
  debugLog("Token in localStorage: "+(githubToken?"YES":"NO"));
  
  if(!githubToken){
    debugLog("‚ö†Ô∏è No token, waiting for setup");
    updateTokenStatus();
    return;
  }
  
  debugLog("üì° Fetching from: "+getGitHubAPI());
  fetch(getGitHubAPI(),{
    headers:{"Authorization":"token "+githubToken}
  })
  .then(r=>{
    debugLog("üì• Status: "+r.status);
    if(!r.ok)throw new Error("HTTP "+r.status);
    return r.json();
  })
  .then(fileData=>{
    debugLog("‚úì File data received, decoding...");
    const contentDecoded=atob(fileData.content);
    const data=JSON.parse(contentDecoded);
    OWNERS=data.owners||{};
    debugLog("‚úì Loaded "+Object.keys(OWNERS).length+" owners");
    updateTokenStatus();
  })
  .catch(e=>{
    debugLog("‚ùå ERROR: "+e.message);
    updateTokenStatus();
  });
}

function setupToken(){
  const token=prompt("PASTE YOUR GITHUB TOKEN:");
  if(!token)return;
  
  githubToken=token.trim();
  localStorage.setItem("github_token",githubToken);
  debugLog("üîë Token saved, verifying...");
  
  fetch("https://api.github.com/user",{headers:{"Authorization":"token "+githubToken}})
    .then(r=>r.json())
    .then(u=>{
      if(u.message){
        alert("‚ùå Invalid token");
        localStorage.removeItem("github_token");
        githubToken="";
        debugLog("‚ùå Token invalid");
        updateTokenStatus();
        return;
      }
      alert("‚úì Token verified!");
      debugLog("‚úì Token verified for user: "+u.login);
      updateTokenStatus();
      loadData();
    })
    .catch(e=>{
      alert("‚ùå Error: "+e.message);
      debugLog("‚ùå Error: "+e.message);
    });
}

function onOwnerChange(){}
function closeAll(){}

// Start on page load
debugLog("üöÄ Page loaded");
loadData();
</script>
</body>
</html>
