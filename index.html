<!DOCTYPE html>
<html>
<head>
<title>Ocean Vacations - Reservation Report</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:Arial;background:#f5f5f5;color:#000;display:flex}.sidebar{width:280px;background:#333;color:#fff;padding:20px;height:100vh;overflow-y:auto;position:fixed;left:0;top:0}.sidebar h3{margin-bottom:20px;font-size:16px;border-bottom:2px solid #fff;padding-bottom:10px}.section{margin-bottom:20px}.label{font-size:11px;font-weight:bold;color:#aaa;margin-bottom:5px;display:block}select,input{width:100%;padding:8px;margin:5px 0;border:1px solid #555;background:#444;color:#fff;border-radius:3px;font-size:11px}.btn{width:100%;padding:12px;margin:8px 0;border:none;font-weight:bold;border-radius:3px;cursor:pointer;font-size:12px;color:#fff;transition:all 0.3s}.btn-primary{background:#000}.btn-success{background:#28a745}.btn-warning{background:#ff9800}.btn-info{background:#17a2b8}.btn-danger{background:#dc3545}.main{margin-left:280px;padding:20px;width:calc(100% - 280px)}.page{background:#fff;padding:40px;border-radius:5px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}.invoice-header{display:flex;justify-content:space-between;margin-bottom:40px;border-bottom:2px solid #000;padding-bottom:30px}.company-info{font-size:11px;line-height:1.8}.company-name{font-size:20px;font-weight:bold;margin-bottom:5px}.report-title{text-align:center;font-size:32px;font-weight:bold;margin:40px 0 10px 0}.owner-name{text-align:center;font-size:28px;margin-bottom:40px;font-weight:bold}table{width:100%;border-collapse:collapse;margin:20px 0;font-size:11px}th,td{border:1px solid #e0e0e0;padding:12px;text-align:left}th{background:#f5f5f5;font-weight:bold;text-transform:uppercase}tr:nth-child(even){background:#fafafa}.summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin:20px 0}.summary-card{background:#f9f9f9;border:1px solid #ddd;padding:12px;text-align:center;border-radius:5px}.summary-label{font-size:10px;color:#666;font-weight:bold}.summary-value{font-size:14px;font-weight:bold;margin-top:6px}.property-section{margin:40px 0;padding:20px;border:1px solid #ddd;border-radius:5px}.property-title{font-size:14px;font-weight:bold;margin-bottom:15px}.modal{display:none;position:fixed;z-index:1001;left:50%;top:50%;transform:translate(-50%,-50%);width:90%;max-width:500px;background:#333;color:#fff;border-radius:8px;padding:30px;box-shadow:0 4px 20px rgba(0,0,0,0.3);max-height:90vh;overflow-y:auto}.modal.show{display:block}.modal-title{font-size:20px;font-weight:bold;margin-bottom:20px;border-bottom:2px solid #fff;padding-bottom:15px}.modal-field{margin-bottom:15px}.modal-label{font-size:11px;font-weight:bold;color:#aaa;margin-bottom:8px;display:block}.modal-input{width:100%;padding:10px;border:1px solid #555;background:#444;color:#fff;border-radius:3px;font-size:11px}.modal-actions{display:flex;gap:10px;margin-top:25px}.modal-actions button{flex:1;padding:12px;border:none;font-weight:bold;border-radius:3px;cursor:pointer;font-size:12px;color:#fff}.btn-add{background:#28a745}.btn-cancel{background:#666}.modal-overlay{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.7)}.modal-overlay.show{display:block}.copy-link-btn{background:#0066cc;color:#fff;padding:10px 15px;border:none;border-radius:3px;cursor:pointer;margin:10px 0;width:100%}.back-btn{background:#666}.owner-box{background:#555;padding:15px;margin:10px 0;border-radius:3px}.owner-input{width:100%;padding:8px;margin:8px 0;border:1px solid #555;background:#444;color:#fff;border-radius:3px;font-size:11px}.vendor-item{background:#555;padding:12px;margin:8px 0;border-radius:3px;display:flex;justify-content:space-between;align-items:center}.vendor-name{font-weight:bold;color:#fff}.vendor-phone{font-size:10px;color:#aaa}.tax-checkbox{display:flex;align-items:center;gap:8px;color:#fff;margin:8px 0;cursor:pointer}.btn-small{padding:5px 10px;font-size:9px;width:auto;display:inline-block}@media print{.sidebar,.back-btn,.copy-link-btn{display:none}.main{margin-left:0;width:100%}}
</style>
</head>
<body>
<div class="sidebar"><h3>üéØ OCEAN VACATIONS</h3>
<div class="section"><label class="label">Select Owner</label><select id="ownerSelect" onchange="onOwnerChange()"><option value="">-- Select --</option></select></div>
<div class="section"><label class="label">Month</label><select id="monthSelect"></select></div>
<div class="section"><label class="label">Year</label><select id="yearSelect"></select></div>
<div class="section"><label class="label">Upload CSV</label><input type="file" id="csvFile" accept=".csv"></div>
<button class="btn btn-primary" onclick="generateStatement()">‚ñ∂ STATEMENT</button>
<button class="btn btn-success" onclick="generateSummary()">üìä Summary</button>
<button class="btn btn-warning" onclick="generateAnnual()">üìà Annual</button>
<hr style="border:1px solid #555;margin:20px 0">
<button class="btn btn-success" onclick="openAddExpense()" style="font-size:13px">üí∞ ADD EXPENSE</button>
<hr style="border:1px solid #555;margin:20px 0">
<h4 style="color:#fff;margin-bottom:10px">üè¢ Vendors</h4>
<input type="text" id="vendorName" placeholder="Name">
<input type="text" id="vendorPhone" placeholder="Phone">
<button class="btn btn-success" onclick="addVendor()" style="font-size:11px">Add Vendor</button>
<button class="btn btn-warning" onclick="showVendors()" style="font-size:11px">View/Manage</button>
<hr style="border:1px solid #555;margin:20px 0">
<button class="btn btn-info" onclick="openOwners()" style="font-size:11px">‚öôÔ∏è Owner Settings</button>
<button class="btn btn-info" onclick="openTax()" style="font-size:11px">‚öôÔ∏è Tax Settings</button>
<button class="btn btn-warning" onclick="setupGitHub()" style="font-size:11px">üîë GitHub Setup</button>
<button class="btn btn-warning" onclick="setupDropbox()" style="font-size:11px">üìÅ Dropbox Setup</button>
</div>

<div id="modalOverlay" class="modal-overlay" onclick="closeAll()"></div>

<div id="ownerModal" class="modal"><div><div class="modal-title">‚öôÔ∏è Owner Settings</div>
<div class="modal-field"><label class="modal-label">Owner Name</label><input type="text" id="ownerNameInput" class="modal-input" placeholder="Owner Name"></div>
<div class="modal-field"><label class="modal-label">Email</label><input type="email" id="ownerEmailInput" class="modal-input" placeholder="Email"></div>
<div class="modal-field"><label class="modal-label">Commission %</label><input type="number" id="ownerCommInput" class="modal-input" placeholder="Commission %" step="0.01"></div>
<div class="modal-field"><label class="modal-label">Sales Fee %</label><input type="number" id="ownerSalesInput" class="modal-input" placeholder="Sales Fee %" step="0.01"></div>
<div class="modal-field"><label class="modal-label">Type</label><select id="ownerTypeInput" class="modal-input"><option value="draft">Draft</option><option value="payout">Payout</option></select></div>
<button class="btn btn-success" onclick="addOwner()" style="width:100%;margin-bottom:20px">‚ûï Add Owner</button>
<div id="ownersList" style="max-height:350px;overflow-y:auto;margin-bottom:20px"></div>
<div class="modal-actions"><button class="btn-cancel" onclick="closeAll()">‚úó Close</button></div>
</div></div>

<div id="taxModal" class="modal"><div><div class="modal-title">‚öôÔ∏è Tax Settings</div>
<div id="taxContent" style="max-height:400px;overflow-y:auto;margin-bottom:20px"></div>
<div class="modal-actions"><button class="btn-cancel" onclick="closeAll()">‚úó Close</button></div>
</div></div>

<div id="vendorModal" class="modal"><div><div class="modal-title">üè¢ Manage Vendors</div>
<div id="vendorsList" style="max-height:300px;overflow-y:auto;margin-bottom:20px"></div>
<div class="modal-actions"><button class="btn-cancel" onclick="closeAll()">‚úó Close</button></div>
</div></div>

<div id="expenseModal" class="modal"><div><div class="modal-title">üí∞ Add Expense</div>
<div class="modal-field"><label class="modal-label">Type</label><select id="expenseType" class="modal-input"><option>Maintenance</option><option>Repair</option><option>Purchase</option><option>Supplies</option><option>Service</option><option>Pool Cleaning</option><option>Pest Control</option></select></div>
<div class="modal-field"><label class="modal-label">Property</label><select id="expenseProperty" class="modal-input"></select></div>
<div class="modal-field"><label class="modal-label">Vendor</label><select id="expenseVendor" class="modal-input"></select></div>
<div class="modal-field"><label class="modal-label">Amount</label><input type="number" id="expenseAmount" class="modal-input" placeholder="0.00" step="0.01"></div>
<div class="modal-field"><label class="modal-label">Notes</label><input type="text" id="expenseNotes" class="modal-input" placeholder="Optional"></div>
<div class="modal-actions"><button class="btn-add" onclick="submitExpense()">‚úì Add</button><button class="btn-cancel" onclick="closeAll()">‚úó Close</button></div>
</div></div>

<div class="main"><div id="content" class="page"><div class="invoice-header"><div class="company-info"><div class="company-name">OCEAN VACATIONS</div><div>www.oceanvacationsmb.com</div><div>oceanvacationsmb@gmail.com</div><div>843-222-6516</div></div><div class="right-header"><div id="statementDate"></div><div id="periodDate"></div></div></div><div class="report-title">RESERVATION REPORT</div><div class="owner-name" id="ownerTitle"></div><div id="mainContent"><div style="text-align:center;padding:40px">Loading data...</div></div></div></div>

<script>
let OWNERS={},vendors=[],expenses=[],csvData=[],propertySettings={},currentOwner="",masterTotals={},propertyTotals={};
const municipalities=["SC","MB","NMB","SSB","HC"];

async function loadData(){try{console.log("Loading from: https://raw.githubusercontent.com/oceanvacationsmb/reports/main/data.json");const e=await fetch("https://raw.githubusercontent.com/oceanvacationsmb/reports/main/data.json?t="+Date.now());console.log("Response status:",e.status);if(!e.ok)throw new Error("HTTP "+e.status);const n=await e.json();console.log("Data loaded:",n);OWNERS=n.owners||{};vendors=n.vendors||[];expenses=n.expenses||[];propertySettings=n.properties||{};init()}catch(e){console.error("Load error:",e);document.getElementById("mainContent").innerHTML="<div style='color:red;padding:40px;text-align:center'><h3>Error loading data from GitHub</h3><p>"+e.message+"</p><p>Click üîë GitHub Setup to set token</p></div>";initBasic()}}

function init(){buildOwners();buildMonths();buildYears();updateVendorDropdown();document.getElementById("mainContent").innerHTML="<div style='text-align:center;padding:40px;color:#666'>Ready! Select owner and upload CSV to begin.</div>"}

function initBasic(){buildMonths();buildYears()}

function buildOwners(){const e=document.getElementById("ownerSelect");e.innerHTML='<option value="">-- Select --</option>';Object.keys(OWNERS).sort().forEach(n=>{e.innerHTML+="<option>"+n+"</option>"})}

function buildMonths(){const e=document.getElementById("monthSelect");const n=["January","February","March","April","May","June","July","August","September","October","November","December"];n.forEach((t,a)=>{e.innerHTML+="<option value='"+(a+1)+"'>"+t+"</option>"});e.value=new Date().getMonth()+1}

function buildYears(){const e=document.getElementById("yearSelect");const n=new Date().getFullYear();for(let t=n-2;t<=n+2;t++){e.innerHTML+="<option>"+t+"</option>"}e.value=n}

function onOwnerChange(){currentOwner=document.getElementById("ownerSelect").value}

function openOwners(){const e=document.getElementById("ownersList");let n="";Object.keys(OWNERS).sort().forEach(t=>{const a=OWNERS[t];n+="<div class='owner-box'><div style='font-weight:bold;color:#fff;margin-bottom:10px'>"+t+"</div>";n+="<label class='modal-label'>Email</label><input type='email' value='"+(a.email||"")+"' onchange=\"OWNERS['"+t+"'].email=this.value\" class='modal-input'>";n+="<label class='modal-label'>Commission %</label><input type='number' step='0.01' value='"+(a.percent*100)+"' onchange=\"OWNERS['"+t+"'].percent=this.value/100\" class='modal-input'>";n+="<label class='modal-label'>Sales Fee %</label><input type='number' step='0.01' value='"+a.salesFeePercent+"' onchange=\"OWNERS['"+t+"'].salesFeePercent=this.value\" class='modal-input'>";n+="<label class='modal-label'>Type</label><select onchange=\"OWNERS['"+t+"'].type=this.value\" class='modal-input'><option value='draft' "+(a.type==='draft'?'selected':'')+">Draft</option><option value='payout' "+(a.type==='payout'?'selected':'')+">Payout</option></select>";n+="<button class='btn btn-danger' onclick=\"deleteOwner('"+t+"')\" style='width:100%;margin-top:10px;padding:8px'>üóëÔ∏è Delete</button></div>"});e.innerHTML=n;openModal("ownerModal")}

function addOwner(){const e=document.getElementById("ownerNameInput").value.trim();const n=document.getElementById("ownerEmailInput").value.trim();const t=parseFloat(document.getElementById("ownerCommInput").value)||0.12;const a=parseFloat(document.getElementById("ownerSalesInput").value)||5;const s=document.getElementById("ownerTypeInput").value;if(!e)return alert("Enter owner name");OWNERS[e]={email:n,percent:t/100,salesFeePercent:a,type:s};document.getElementById("ownerNameInput").value="";document.getElementById("ownerEmailInput").value="";document.getElementById("ownerCommInput").value="";document.getElementById("ownerSalesInput").value="";saveData();buildOwners();openOwners()}

function deleteOwner(e){if(!confirm("Delete owner "+e+"?"))return;delete OWNERS[e];saveData();buildOwners();openOwners()}

function openTax(){const e=document.getElementById("taxContent");let n="";Object.keys(OWNERS).sort().forEach(t=>{const a=propertySettings[t]||{};n+="<div style='background:#555;padding:15px;margin:10px 0;border-radius:3px'><div style='font-weight:bold;color:#fff;margin-bottom:10px'>"+t+"</div>";municipalities.forEach(s=>{const r=a[s]?"checked":"";n+="<label class='tax-checkbox'><input type='checkbox' "+r+" onchange=\"if(!propertySettings['"+t+"'])propertySettings['"+t+"']={};propertySettings['"+t+"']['"+s+"']=this.checked\"><span>"+s+"</span></label>"});n+="</div>"});e.innerHTML=n;openModal("taxModal")}

function updateVendorDropdown(){const e=document.getElementById("expenseVendor");e.innerHTML="<option>--Select--</option>";vendors.forEach(n=>{e.innerHTML+="<option>"+n.name+"</option>"})}

function addVendor(){const e=document.getElementById("vendorName").value.trim();const n=document.getElementById("vendorPhone").value.trim();if(!e)return alert("Enter vendor name");vendors.push({id:Date.now(),name:e,phone:n});document.getElementById("vendorName").value="";document.getElementById("vendorPhone").value="";updateVendorDropdown();saveData();alert("‚úì Added")}

function showVendors(){const e=document.getElementById("vendorsList");let n="";vendors.forEach(t=>{n+="<div class='vendor-item'><div><div class='vendor-name'>"+t.name+"</div><div class='vendor-phone'>"+t.phone+"</div></div><button class='btn btn-danger' onclick='deleteVendor("+t.id+")' style='padding:5px 10px;font-size:9px'>Delete</button></div>"});e.innerHTML=n||"<p style='color:#aaa'>No vendors</p>";openModal("vendorModal")}

function deleteVendor(e){vendors=vendors.filter(n=>n.id!==e);saveData();showVendors()}

function openAddExpense(){if(!currentOwner)return alert("Select owner");const e=document.getElementById("expenseProperty");e.innerHTML="<option>--Select--</option>";Object.keys(propertyTotals).forEach(n=>{e.innerHTML+="<option>"+n+"</option>"});openModal("expenseModal")}

function submitExpense(){const e=document.getElementById("expenseType").value;const n=document.getElementById("expenseProperty").value;const t=document.getElementById("expenseVendor").value;const a=parseFloat(document.getElementById("expenseAmount").value);if(!currentOwner||!n||!t||!a)return alert("Fill all fields");expenses.push({id:Date.now(),owner:currentOwner,type:e,property:n,vendor:t,amount:a,notes:document.getElementById("expenseNotes").value});closeAll();saveData();alert("‚úì Added")}

function setupGitHub(){const e=prompt("GitHub Token:");if(e&&e.trim()){localStorage.setItem("github_token",e.trim());loadData()}}

function setupDropbox(){const e=prompt("Dropbox Access Token:");if(e&&e.trim()){localStorage.setItem("dropbox_token",e.trim());alert("‚úì Saved")}}

async function saveData(){const e=localStorage.getItem("github_token");if(!e){console.log("No GitHub token");return}try{const n=JSON.stringify({owners:OWNERS,vendors:vendors,properties:propertySettings,expenses:expenses},null,2);const t=btoa(unescape(encodeURIComponent(n)));const a=await fetch("https://api.github.com/repos/oceanvacationsmb/reports/contents/data.json",{headers:{"Authorization":"token "+e}});const s=await a.json();const r=await fetch("https://api.github.com/repos/oceanvacationsmb/reports/contents/data.json",{method:"PUT",headers:{"Authorization":"token "+e,"Content-Type":"application/json"},body:JSON.stringify({message:"Update "+new Date().toLocaleString(),content:t,sha:s.sha})});if(r.ok)console.log("Saved")}catch(e){console.error(e)}}

function generateStatement(){const e=document.getElementById("csvFile").files[0];if(!e||!currentOwner)return;const n=new FileReader();n.onload=t=>{csvData=Papa.parse(t.target.result,{header:true,skipEmptyLines:true}).data;const a=parseInt(document.getElementById("monthSelect").value);const s=parseInt(document.getElementById("yearSelect").value);const r=["January","February","March","April","May","June","July","August","September","October","November","December"];const i=new Date(s,a,0).getDate();let o=a+1,l=s;if(o>12){o=1;l++}document.getElementById("statementDate").innerHTML="<strong>"+r[o-1]+" 1, "+l+"</strong>";document.getElementById("periodDate").innerHTML="<strong>"+r[a-1]+" 1-"+i+", "+s+"</strong>";document.getElementById("ownerTitle").textContent=currentOwner;processData(a,s);displayStatement()};n.readAsText(e)}

function processData(e,n){const t=OWNERS[currentOwner];propertyTotals={};masterTotals={gross:0,acc:0,clean:0,pmc:0,expenses:0};let a={};csvData.forEach(t=>{if(!t["CHECK-IN DATE"])return;const s=parseInt(t["CHECK-IN DATE"].split("-")[1]),r=parseInt(t["CHECK-IN DATE"].split("-")[0]);if(s!==e||r!==n)return;const i=t["LISTING'S NICKNAME"]||"Unknown";if(!a[i])a[i]=[];a[i].push(t)});Object.keys(a).forEach(e=>{let n=0,s=0,r=0,i=0;a[e].forEach(e=>{const a=parseFloat((e["TOTAL PAYOUT"]||"0").replace(/[$,]/g,""));const d=parseFloat((e["ACCOMMODATION FARE"]||"0").replace(/[$,]/g,""))-parseFloat((e["MARKUP"]||"0").replace(/[$,]/g,""));const c=(e["STATUS"]||"").toLowerCase().includes("cancelled")?0:parseFloat((e["CLEANING FARE"]||"0").replace(/[$,]/g,""));const o=d*t.percent;n+=a;s+=d;r+=c;i+=o});const d=expenses.filter(n=>n.property===e&&n.owner===currentOwner).reduce((e,n)=>e+n.amount,0);propertyTotals[e]={gross:n,acc:s,clean:r,pmc:i,expenses:d,owner:s-i-d,reservations:a[e]};masterTotals.gross+=n;masterTotals.acc+=s;masterTotals.clean+=r;masterTotals.pmc+=i;masterTotals.expenses+=d})}

function displayStatement(){const e=OWNERS[currentOwner].type;let n="<div style='display:flex;gap:10px;justify-content:center;margin:20px 0'><button class='copy-link-btn' onclick='generateLink()'>üîó Generate Link</button></div>";n+="<div style='font-size:12px;font-weight:bold;text-transform:uppercase;text-align:center;margin:20px 0'>Financial Summary</div><div class='summary-grid'>";if(e==="draft"){n+="<div class='summary-card'><div class='summary-label'>Gross Payout</div><div class='summary-value'>$"+masterTotals.gross.toFixed(2)+"</div></div>";n+="<div class='summary-card'><div class='summary-label'>Accommodation</div><div class='summary-value'>$"+masterTotals.acc.toFixed(2)+"</div></div>";n+="<div class='summary-card'><div class='summary-label'>PMC</div><div class='summary-value'>$"+masterTotals.pmc.toFixed(2)+"</div></div>";n+="<div class='summary-card'><div class='summary-label'>Cleaning</div><div class='summary-value'>$"+masterTotals.clean.toFixed(2)+"</div></div>";n+="<div class='summary-card' style='background:#000;color:#fff'><div class='summary-label' style='color:#fff'>AMOUNT DUE</div><div class='summary-value' style='color:#fff'>$"+(masterTotals.pmc+masterTotals.clean).toFixed(2)+"</div></div>"}else{n+="<div class='summary-card'><div class='summary-label'>Accommodation</div><div class='summary-value'>$"+masterTotals.acc.toFixed(2)+"</div></div>";n+="<div class='summary-card'><div class='summary-label'>PMC</div><div class='summary-value'>$"+masterTotals.pmc.toFixed(2)+"</div></div>";n+="<div class='summary-card' style='background:#000;color:#fff'><div class='summary-label' style='color:#fff'>OWNER PAYOUT</div><div class='summary-value' style='color:#fff'>$"+(masterTotals.acc-masterTotals.pmc).toFixed(2)+"</div></div>"}n+="</div>";Object.keys(propertyTotals).forEach(t=>{const a=propertyTotals[t];n+="<div class='property-section'><div class='property-title'>"+t.toUpperCase()+"</div><table><tr><th>Code</th><th>Check-in</th><th>Accommodation</th><th>PMC</th></tr>";a.reservations.forEach(e=>{const s=parseFloat((e["ACCOMMODATION FARE"]||"0").replace(/[$,]/g,""))-parseFloat((e["MARKUP"]||"0").replace(/[$,]/g,""));const r=s*OWNERS[currentOwner].percent;n+="<tr><td>"+(e["CONFIRMATION CODE"]||"").substring(0,8)+"</td><td>"+(e["CHECK-IN DATE"]||"")+"</td><td>$"+s.toFixed(2)+"</td><td>$"+r.toFixed(2)+"</td></tr>"});const s=expenses.filter(n=>n.property===t&&n.owner===currentOwner);if(s.length>0){n+="</table><div style='margin-top:15px'><div style='font-weight:bold;margin-bottom:10px'>EXPENSES</div>";s.forEach(e=>{n+="<div class='attachment'><div><strong>"+e.type+"</strong> - "+e.vendor+": $"+e.amount.toFixed(2)+"</div></div>"});n+="</div></div>"}else n+="</table></div>"});document.getElementById("mainContent").innerHTML=n}

function generateSummary(){document.getElementById("mainContent").innerHTML="<button class='back-btn' onclick='displayStatement()'>‚Üê Back</button><h2 style='text-align:center'>COMMISSION</h2><div style='background:#fff3cd;border:2px solid #ffc107;padding:20px;border-radius:5px;text-align:center'><h3 style='color:#856404'>$"+masterTotals.pmc.toFixed(2)+"</h3></div>"}

function generateAnnual(){document.getElementById("mainContent").innerHTML="<button class='back-btn' onclick='displayStatement()'>‚Üê Back</button><h2 style='text-align:center'>ANNUAL SUMMARY</h2><table><tr><td><strong>Total Accommodation</strong></td><td style='text-align:right'><strong>$"+masterTotals.acc.toFixed(2)+"</strong></td></tr><tr><td>PMC</td><td style='text-align:right'>$"+masterTotals.pmc.toFixed(2)+"</td></tr><tr style='background:#000;color:#fff'><td><strong>NET</strong></td><td style='text-align:right'><strong>$"+(masterTotals.acc-masterTotals.pmc).toFixed(2)+"</strong></td></tr></table>"}

async function generateLink(){const e=localStorage.getItem("dropbox_token");if(!e)return alert("Setup Dropbox first");const n=currentOwner+"_"+Date.now()+".html";const t=document.getElementById("content").innerHTML;try{const a=await fetch("https://content.dropboxapi.com/2/files/upload",{method:"POST",headers:{"Authorization":"Bearer "+e,"Dropbox-API-Arg":JSON.stringify({path:"/statements/"+n,mode:"add"})},body:t});if(a.ok){const s=await fetch("https://www.dropboxapi.com/2/sharing/create_shared_link_with_settings",{method:"POST",headers:{"Authorization":"Bearer "+e,"Content-Type":"application/json"},body:JSON.stringify({path:"/statements/"+n,settings:{requested_visibility:"public"}})});if(s.ok){const n=await s.json();const r=n.url.replace("?dl=0","?dl=1");document.getElementById("mainContent").innerHTML+="<div style='background:#d4edda;border:2px solid #28a745;padding:15px;margin:20px 0;border-radius:5px;text-align:center'><h3 style='color:#155724'>‚úì Generated!</h3><button class='copy-link-btn' onclick=\"copyToClipboard('"+r+"')\">üìã Copy Link</button><p style='font-size:11px;color:#155724;word-break:break-all;margin-top:10px'>"+r+"</p></div>"}}else alert("Error")}else alert("Upload failed")}catch(e){alert(e)}}

function copyToClipboard(e){navigator.clipboard.writeText(e).then(()=>alert("‚úì Copied")).catch(()=>alert("Failed"))}

function openModal(e){document.getElementById("modalOverlay").classList.add("show");document.getElementById(e).classList.add("show")}

function closeAll(){document.getElementById("modalOverlay").classList.remove("show");document.querySelectorAll(".modal").forEach(e=>e.classList.remove("show"))}

loadData();
</script>
</body>
</html>
