<!DOCTYPE html>
<html>
<head>
<title>Ocean Vacations - Reservation Report</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:Arial;background:#f5f5f5;color:#000;display:flex}.sidebar{width:280px;background:#333;color:#fff;padding:20px;height:100vh;overflow-y:auto;position:fixed;left:0;top:0}.sidebar h3{margin-bottom:20px;font-size:16px;border-bottom:2px solid #fff;padding-bottom:10px}.section{margin-bottom:20px}.label{font-size:11px;font-weight:bold;color:#aaa;margin-bottom:5px;display:block}select,input{width:100%;padding:8px;margin:5px 0;border:1px solid #555;background:#444;color:#fff;border-radius:3px;font-size:11px}.btn{width:100%;padding:12px;margin:8px 0;border:none;font-weight:bold;border-radius:3px;cursor:pointer;font-size:12px;color:#fff;transition:all 0.3s}.btn-primary{background:#000}.btn-success{background:#28a745}.btn-warning{background:#ff9800}.btn-info{background:#17a2b8}.btn-danger{background:#dc3545}.main{margin-left:280px;padding:20px;width:calc(100% - 280px)}.page{background:#fff;padding:40px;border-radius:5px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}.invoice-header{display:flex;justify-content:space-between;margin-bottom:40px;border-bottom:2px solid #000;padding-bottom:30px}.company-info{font-size:11px;line-height:1.8}.company-name{font-size:20px;font-weight:bold;margin-bottom:5px}.report-title{text-align:center;font-size:32px;font-weight:bold;margin:40px 0 10px 0}.owner-name{text-align:center;font-size:28px;margin-bottom:40px;font-weight:bold}table{width:100%;border-collapse:collapse;margin:20px 0;font-size:11px}th,td{border:1px solid #e0e0e0;padding:12px;text-align:left}th{background:#f5f5f5;font-weight:bold;text-transform:uppercase}.summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin:20px 0}.summary-card{background:#f9f9f9;border:1px solid #ddd;padding:12px;text-align:center;border-radius:5px}.summary-label{font-size:10px;color:#666;font-weight:bold;text-transform:uppercase}.summary-value{font-size:14px;font-weight:bold;color:#000;margin-top:6px}.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5)}.modal-content{background:#fff;margin:10% auto;padding:20px;width:80%;max-width:600px;border-radius:5px;max-height:80vh;overflow-y:auto}.btn-small{padding:5px 10px;font-size:9px;width:auto;margin:0;display:inline-block}.invoice-btn{background:#17a2b8;color:#fff;padding:3px 8px;border:none;border-radius:3px;cursor:pointer;font-size:9px;font-weight:bold}
</style>
</head>
<body>
<div class="sidebar"><h3>üéØ OCEAN VACATIONS</h3>
<div class="section"><label class="label">Select Owner</label><select id="ownerSelect" onchange="onOwnerChange()"><option>-- Select Owner --</option></select></div>
<div class="section"><label class="label">Month</label><select id="monthSelect"></select></div>
<div class="section"><label class="label">Year</label><select id="yearSelect"></select></div>
<div class="section"><label class="label">Upload CSV</label><input type="file" id="csvFile" accept=".csv"></div>
<button class="btn btn-primary" onclick="generateStatement()">‚ñ∂ STATEMENT</button>
<button class="btn btn-success" onclick="generateSummary()">üìä View Summary</button>
<button class="btn btn-warning" onclick="generateAnnual()">üìà Annual Report</button>
<button class="btn btn-info" onclick="downloadPDF()">üì• Download PDF</button>
<hr style="border:1px solid #555;margin:20px 0">
<button class="btn btn-success" onclick="openAddExpense()">üí∞ ADD EXPENSE</button>
<hr style="border:1px solid #555;margin:20px 0">
<h4 style="color:#fff;margin-bottom:10px">üè¢ Vendors</h4>
<input type="text" id="vendorName" placeholder="Name">
<input type="text" id="vendorPhone" placeholder="Phone">
<button class="btn btn-success" onclick="addVendor()" style="font-size:11px">Add</button>
<button class="btn btn-warning" onclick="viewVendors()" style="font-size:11px">View</button>
<hr style="border:1px solid #555;margin:20px 0">
<button class="btn btn-info" onclick="setupGitHub()" style="font-size:11px">üîë GitHub Setup</button>
</div>

<div id="vendorModal" class="modal"><div class="modal-content"><span onclick="this.parentElement.parentElement.style.display='none'" style="float:right;cursor:pointer;font-size:28px">&times;</span><h2>Vendors</h2><div id="vendorList" style="margin-top:20px"></div></div></div>

<div class="main"><div class="page"><div class="invoice-header"><div class="company-info"><div class="company-name">OCEAN VACATIONS</div><div>www.oceanvacationsmb.com</div><div>oceanvacationsmb@gmail.com</div><div>843-222-6516</div></div><div class="right-header"><div id="statementDate"></div><div id="periodDate"></div></div></div><div class="report-title">RESERVATION REPORT</div><div class="owner-name" id="ownerTitle"></div><div id="mainContent"><div style="text-align:center;padding:40px;color:#666">Select owner, upload CSV, click STATEMENT</div></div></div></div>

<script>
const GITHUB_URL="https://raw.githubusercontent.com/oceanvacationsmb/reports/main/data.json";
let gitHubData={},vendors=[],expenses=[],csvData=[],properties=[],currentOwner="",masterTotals={},propertyTotals={};
const OWNERS={"ERAN":{percent:0.12,type:"draft"},"GHO":{percent:0.10,type:"payout"},"1463 Basin Trail":{percent:0.12,type:"payout"},"113B-15S Surfside Beach":{percent:0.12,type:"payout"},"113B-13N Surfside Beach":{percent:0.12,type:"payout"},"115C-15N Surfside Beach":{percent:0.12,type:"payout"},"2131 Sanibel Myrtle Beach":{percent:0.15,type:"payout"},"1552 Elizabeth Ln Myrtle Beach":{percent:0.15,type:"payout"},"469C White River RD Myrtle Beach":{percent:0.12,type:"payout"},"4631-301 Wild Iris Drive Myrtle Beach":{percent:0.12,type:"payout"},"4679-204 Wild Iris Drive Myrtle Beach":{percent:0.12,type:"payout"},"508-1/2 33rd Ave North Myrtle Beach":{percent:0.15,type:"payout"},"214-2S 2nd Ave S. North Myrtle Beach":{percent:0.12,type:"payout"}};

async function loadData(){try{const r=await fetch(GITHUB_URL+"?t="+Date.now());gitHubData=await r.json();vendors=gitHubData.vendors||[];expenses=gitHubData.expenses||[]}catch(e){console.log(e)}buildOwners();buildMonths();buildYears();updateVendors()}
function buildOwners(){const e=document.getElementById("ownerSelect");e.innerHTML='<option>-- Select Owner --</option>';Object.keys(OWNERS).sort().forEach(n=>{const t=document.createElement("option");t.value=n;t.textContent=n;e.appendChild(t)})}
function buildMonths(){const e=document.getElementById("monthSelect");["January","February","March","April","May","June","July","August","September","October","November","December"].forEach((n,t)=>{const a=document.createElement("option");a.value=t+1;a.textContent=n;e.appendChild(a)});e.value=new Date().getMonth()+1}
function buildYears(){const e=document.getElementById("yearSelect");const n=new Date().getFullYear();for(let t=n-2;t<=n+2;t++){const a=document.createElement("option");a.value=t;a.textContent=t;e.appendChild(a)}e.value=n}
function onOwnerChange(){currentOwner=document.getElementById("ownerSelect").value}
function getMonthName(e){const n=["January","February","March","April","May","June","July","August","September","October","November","December"];return n[e-1]}
function getNextMonth(e,n){let t=e+1,a=n;if(t>12){t=1;a++}return{month:t,year:a}}
function updateDates(){const e=parseInt(document.getElementById("monthSelect").value);const n=parseInt(document.getElementById("yearSelect").value);const t=getNextMonth(e,n);const a=new Date(n,e,0).getDate();document.getElementById("statementDate").innerHTML="Date: "+getMonthName(t.month)+" 1st "+t.year;document.getElementById("periodDate").innerHTML="Period: "+getMonthName(e)+" 1-"+a+" "+n;document.getElementById("ownerTitle").textContent=currentOwner}
function money(e){return"$"+(Number(e)||0).toFixed(2)}
function num(e){return parseFloat((e||"0").toString().replace(/[$,]/g,""))||0}
async function generateStatement(){const e=document.getElementById("csvFile").files[0];if(!e||!currentOwner){alert("Select owner and upload CSV");return}updateDates();const n=new FileReader();n.onload=t=>{csvData=Papa.parse(t.target.result,{header:true,skipEmptyLines:true}).data;processCSV();displayStatement()};n.readAsText(e)}
function processCSV(){const e=parseInt(document.getElementById("monthSelect").value);const n=parseInt(document.getElementById("yearSelect").value);const t=OWNERS[currentOwner].percent;propertyTotals={};masterTotals={acc:0,pmc:0,expenses:0,owner:0};properties=[];let a={};csvData.forEach(t=>{if(!t["CHECK-IN DATE"])return;let s=parseInt(t["CHECK-IN DATE"].split("-")[1]);let r=parseInt(t["CHECK-IN DATE"].split("-")[0]);if(s!==e||r!==n)return;let i=t["LISTING'S NICKNAME"]||"Unknown";if(!properties.includes(i))properties.push(i);if(!a[i])a[i]=[];a[i].push(t)});Object.keys(a).forEach(e=>{let n=0,s=0,r=0;a[e].forEach(e=>{let i=num(e["ACCOMMODATION FARE"])-num(e["MARKUP"]);let d=(e["STATUS"]||"").toLowerCase();let c=d.includes("cancelled")?0:num(e["CLEANING FARE"]);let o=i*t;n+=i;s+=o;r+=c});let i=expenses.filter(n=>n.property===e&&n.owner===currentOwner).reduce((e,n)=>e+n.amount,0);propertyTotals[e]={acc:n,pmc:s,clean:r,exp:i,owner:n-s-i,reservations:a[e]};masterTotals.acc+=n;masterTotals.pmc+=s;masterTotals.expenses+=i;masterTotals.owner+=n-s-i})}
function displayStatement(){let e="<div style='margin:20px 0'>";Object.keys(propertyTotals).forEach(n=>{let t=propertyTotals[n];e+="<div style='margin:30px 0;padding:20px;border:1px solid #ddd;border-radius:5px'><h3>"+n+"</h3>";e+="<div class='summary-grid'><div class='summary-card'><div class='summary-label'>Accommodation</div><div class='summary-value'>"+money(t.acc)+"</div></div><div class='summary-card'><div class='summary-label'>PMC</div><div class='summary-value'>"+money(t.pmc)+"</div></div><div class='summary-card'><div class='summary-label'>Expenses</div><div class='summary-value'>"+money(t.exp)+"</div></div><div class='summary-card'><div class='summary-label'>Owner Payout</div><div class='summary-value'>"+money(t.owner)+"</div></div></div>";e+="<h4 style='margin-top:20px'>Reservations</h4><table><tr><th>Code</th><th>Platform</th><th>Stay</th><th>Accommodation</th><th>PMC</th></tr>";t.reservations.forEach(n=>{let a=num(n["ACCOMMODATION FARE"])-num(n["MARKUP"]);let s=a*OWNERS[currentOwner].percent;let r=n["CONFIRMATION CODE"]||"";let i=n["PLATFORM"]||"N/A";let d=n["CHECK-IN DATE"]?n["CHECK-IN DATE"].split("-").slice(1).join("/"):"";let c=n["CHECK-OUT DATE"]?n["CHECK-OUT DATE"].split("-").slice(1).join("/"):"";if(a===0)return;e+="<tr><td>"+r.substring(0,8)+"</td><td>"+i+"</td><td>"+d+"-"+c+"</td><td>"+money(a)+"</td><td>"+money(s)+"</td></tr>"});e+="</table></div>"});e+="<div style='margin:30px 0;padding:20px;background:#000;color:#fff;border-radius:5px'><h3>TOTAL OWNER PAYOUT: "+money(masterTotals.owner)+"</h3></div>";document.getElementById("mainContent").innerHTML=e}
async function generateSummary(){if(!csvData||csvData.length===0){alert("Generate statement first");return}let e="<div style='padding:20px'><h2>Summary</h2>";e+="<p>Total Accommodation: "+money(masterTotals.acc)+"</p>";e+="<p>Total PMC: "+money(masterTotals.pmc)+"</p>";e+="<p>Total Expenses: "+money(masterTotals.expenses)+"</p>";e+="<p><strong>Owner Payout: "+money(masterTotals.owner)+"</strong></p></div>";document.getElementById("mainContent").innerHTML=e}
async function generateAnnual(){if(!csvData||csvData.length===0){alert("Generate statement first");return}alert("Annual report for "+currentOwner+": "+money(masterTotals.owner))}
function downloadPDF(){html2pdf().from(document.querySelector(".page")).save("Report.pdf")}
function setupGitHub(){const e=prompt("GitHub Token:");if(e){localStorage.setItem("github_token",e);loadData()}}
function addVendor(){const e=document.getElementById("vendorName").value;const n=document.getElementById("vendorPhone").value;if(!e)return;vendors.push({id:Date.now(),name:e,phone:n});document.getElementById("vendorName").value="";document.getElementById("vendorPhone").value="";saveVendors()}
function updateVendors(){}
function viewVendors(){const e=document.getElementById("vendorModal");const n=document.getElementById("vendorList");n.innerHTML="";vendors.forEach(t=>{n.innerHTML+="<div style='padding:10px;margin:10px 0;background:#f0f0f0'><strong>"+t.name+"</strong> - "+t.phone+" <button onclick='deleteVendor("+t.id+")' class='btn-small btn-danger'>Delete</button></div>"});e.style.display="block"}
function deleteVendor(e){vendors=vendors.filter(n=>n.id!==e);saveVendors();viewVendors()}
async function saveVendors(){const e={...gitHubData,vendors:vendors};const n=localStorage.getItem("github_token");if(n){const t=JSON.stringify(e,null,2);const a=btoa(unescape(encodeURIComponent(t)));const s=await fetch("https://api.github.com/repos/oceanvacationsmb/reports/contents/data.json",{headers:{"Authorization":"token "+n}});const r=await s.json();await fetch("https://api.github.com/repos/oceanvacationsmb/reports/contents/data.json",{method:"PUT",headers:{"Authorization":"token "+n,"Content-Type":"application/json"},body:JSON.stringify({message:"Update vendors",content:a,sha:r.sha,branch:"main"})})}}
function openAddExpense(){const e=prompt("Enter expense (Type|Property|Vendor|Amount):");if(!e)return;const n=e.split("|");if(n.length!==4)return;expenses.push({id:Date.now(),owner:currentOwner,type:n[0],property:n[1],vendor:n[2],amount:parseFloat(n[3])});processCSV();displayStatement()}

window.onload=loadData;
</script>
</body>
</html>
